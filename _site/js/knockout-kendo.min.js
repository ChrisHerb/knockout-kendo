//knockout-kendo v0.3.0 | (c) 2012 Ryan Niemeyer | http://www.opensource.org/licenses/mit-license
(function(ko,$,undefined){ko.kendo=ko.kendo||{},ko.kendo.BindingFactory=function(){var self=this;this.createBinding=function(widgetConfig){if(!$()[widgetConfig.parent||widgetConfig.name])return;var binding={};binding.init=function(element,valueAccessor){var options=self.buildOptions(widgetConfig,valueAccessor);if(options.async===!0||widgetConfig.async===!0&&options.async!==!1){setTimeout(function(){binding.setup(element,options)},0);return}binding.setup(element,options)},binding.setup=function(element,options){var widget,$element=$(element);widget=self.getWidget(widgetConfig,options,$element),self.handleEvents(options,widgetConfig,element,widget),self.watchValues(widget,options,widgetConfig,element),widget.destroy&&ko.utils.domNodeDisposal.addDisposeCallback(element,function(){widget.destroy()})},binding.options={},binding.widgetConfig=widgetConfig,ko.bindingHandlers[widgetConfig.bindingName||widgetConfig.name]=binding},this.buildOptions=function(widgetConfig,valueAccessor){var defaultOption=widgetConfig.defaultOption,options=ko.utils.extend({},ko.bindingHandlers[widgetConfig.name].options),valueOrOptions=ko.utils.unwrapObservable(valueAccessor());return typeof valueOrOptions!="object"||defaultOption&&!(defaultOption in valueOrOptions)?options[defaultOption]=valueAccessor():ko.utils.extend(options,valueOrOptions),options},this.getWidget=function(widgetConfig,options,$element){var widget;if(widgetConfig.parent){var parent=$element.closest("[data-bind*='"+widgetConfig.parent+":']");widget=parent.length?parent.data(widgetConfig.parent):null}else widget=$element[widgetConfig.name](ko.toJS(options)).data(widgetConfig.name);return ko.isObservable(options.widget)&&options.widget(widget),widget},this.watchValues=function(widget,options,widgetConfig,element){var watchProp,watchValues=widgetConfig.watch;if(watchValues)for(watchProp in watchValues)watchValues.hasOwnProperty(watchProp)&&self.watchOneValue(watchProp,widget,options,widgetConfig,element)},this.watchOneValue=function(prop,widget,options,widgetConfig,element){var computed=ko.computed({read:function(){var action=widgetConfig.watch[prop],value=ko.utils.unwrapObservable(options[prop]),params=widgetConfig.parent?[element]:[],existing;$.isArray(action)?action=widget[value?action[0]:action[1]]:typeof action=="string"&&(action=widget[action]),action&&(existing=action.apply(widget,params),existing!==value&&(params.push(value),action.apply(widget,params)))},disposeWhenNodeIsRemoved:element});ko.isObservable(options[prop])||computed.dispose()},this.handleEvents=function(options,widgetConfig,element,widget){var prop,event,events=widgetConfig.events;if(events)for(prop in events)events.hasOwnProperty(prop)&&(event=events[prop],typeof event=="string"&&(event={value:event,writeTo:event}),ko.isObservable(options[event.writeTo])&&self.handleOneEvent(prop,event,options,element,widget,widgetConfig.childProp))},this.handleOneEvent=function(eventName,eventConfig,options,element,widget,childProp){widget.bind(eventName,function(e){var propOrValue,value;if(!childProp||!e[childProp]||e[childProp]===element)propOrValue=eventConfig.value,value=typeof propOrValue=="string"&&this[propOrValue]?this[propOrValue](childProp&&element):propOrValue,options[eventConfig.writeTo](value)})}},ko.kendo.bindingFactory=new ko.kendo.BindingFactory,ko.kendo.setDataSource=function(widget,data){widget.dataSource.data(ko.mapping?ko.mapping.toJS(data||{}):ko.toJS(data))};var extendAndRedraw=function(prop){return function(value){value&&(ko.utils.extend(this.options[prop],value),this.redraw(),this.value(.001+this.value()))}},createBinding=ko.kendo.bindingFactory.createBinding.bind(ko.kendo.bindingFactory),CLOSE="close",COLLAPSE="collapse",CONTENT="content",DATA="data",DISABLE="disable",ENABLE="enable",EXPAND="expand",ENABLED="enabled",EXPANDED="expanded",ISOPEN="isOpen",MAX="max",MIN="min",OPEN="open",RESIZE="resize",SEARCH="search",SELECT="select",SELECTED="selected",SIZE="size",TITLE="title",VALUE="value",VALUES="values";createBinding({name:"kendoAutoComplete",events:{change:VALUE,open:{writeTo:ISOPEN,value:!0},close:{writeTo:ISOPEN,value:!1}},watch:{enabled:ENABLE,search:[SEARCH,CLOSE],data:function(value){ko.kendo.setDataSource(this,value)},value:VALUE}}),createBinding({name:"kendoCalendar",defaultOption:VALUE,events:{change:VALUE},watch:{max:MAX,min:MIN,value:VALUE}}),createBinding({name:"kendoComboBox",events:{change:VALUE,open:{writeTo:ISOPEN,value:!0},close:{writeTo:ISOPEN,value:!1}},watch:{enabled:ENABLE,isOpen:[OPEN,CLOSE],data:function(value){ko.kendo.setDataSource(this,value)},value:VALUE}}),createBinding({name:"kendoDatePicker",defaultOption:VALUE,events:{change:VALUE,open:{writeTo:ISOPEN,value:!0},close:{writeTo:ISOPEN,value:!1}},watch:{enabled:ENABLE,max:MAX,min:MIN,value:VALUE,isOpen:[OPEN,VALUE]}}),createBinding({name:"kendoDropDownList",events:{change:VALUE,open:{writeTo:ISOPEN,value:!0},close:{writeTo:ISOPEN,value:!1}},watch:{enabled:ENABLE,isOpen:[OPEN,CLOSE],data:function(value){ko.kendo.setDataSource(this,value)},value:VALUE}}),createBinding({name:"kendoEditor",defaultOption:VALUE,events:{change:VALUE},watch:{enabled:ENABLE,value:VALUE}}),createBinding({name:"kendoGrid",defaultOption:DATA,watch:{data:function(value){ko.kendo.setDataSource(this,value)}}}),createBinding({name:"kendoListView",defaultOption:DATA,watch:{data:function(value){ko.kendo.setDataSource(this,value)}}}),createBinding({name:"kendoMenu",async:!0}),createBinding({name:"kendoMenuItem",parent:"kendoMenu",watch:{enabled:ENABLE,isOpen:[OPEN,CLOSE]},async:!0}),createBinding({name:"kendoNumericTextBox",defaultOption:VALUE,events:{change:VALUE},watch:{enabled:ENABLE,value:VALUE,max:function(newMax){this.options.max=newMax,this.value()>newMax&&this.value(newMax)},min:function(newMin){this.options.min=newMin,this.value()<newMin&&this.value(newMin)}}}),createBinding({name:"kendoPanelBar",async:!0}),createBinding({name:"kendoPanelItem",parent:"kendoPanelBar",watch:{enabled:ENABLE,expanded:[EXPAND,COLLAPSE]},childProp:"item",events:{expand:{writeTo:EXPANDED,value:!0},collapse:{writeTo:EXPANDED,value:!1}},async:!0}),createBinding({name:"kendoRangeSlider",defaultOption:VALUES,events:{change:VALUES},watch:{values:VALUES,enabled:[ENABLE,DISABLE]}}),createBinding({name:"kendoSlider",defaultOption:VALUE,events:{change:VALUE},watch:{value:VALUE,enabled:[ENABLE,DISABLE]}}),createBinding({name:"kendoSplitter",async:!0}),createBinding({name:"kendoSplitterPane",parent:"kendoSplitter",watch:{max:MAX,min:MIN,size:SIZE,expanded:[EXPAND,COLLAPSE]},childProp:"pane",events:{collapse:{writeTo:EXPANDED,value:!1},expand:{writeTo:EXPANDED,value:!0},resize:SIZE},async:!0}),createBinding({name:"kendoTabStrip",async:!0}),createBinding({name:"kendoTab",parent:"kendoTabStrip",watch:{selected:function(element,value){this.select(value?element:null)},enabled:ENABLE},childProp:"item",events:{selected:{writeTo:SELECTED,value:!0}},async:!0}),createBinding({name:"kendoTimePicker",defaultOption:VALUE,events:{change:VALUE},watch:{max:MAX,min:MIN,value:VALUE,enabled:ENABLE,isOpen:[OPEN,CLOSE]}}),createBinding({name:"kendoTreeView",async:!0}),createBinding({name:"kendoTreeItem",parent:"kendoTreeView",watch:{enabled:ENABLE,expanded:[EXPAND,COLLAPSE],selected:function(element,value){this.select(value?element:null)}},childProp:"node",events:{collapse:{writeTo:EXPANDED,value:!1},expand:{writeTo:EXPANDED,value:!0},select:{writeTo:SELECTED,value:!0}},async:!0}),createBinding({name:"kendoUpload",watch:{enabled:[ENABLE,DISABLE]}}),createBinding({async:!0,name:"kendoWindow",events:{open:{writeTo:ISOPEN,value:!0},close:{writeTo:ISOPEN,value:!1}},watch:{content:CONTENT,title:TITLE,isOpen:[OPEN,CLOSE]}}),createBinding({name:"kendoChart",watch:{data:function(value){ko.kendo.setDataSource(this,value)}}}),createBinding({name:"kendoLinearGauge",defaultOption:VALUE,watch:{value:VALUE,gaugeArea:extendAndRedraw("gaugeArea"),pointer:extendAndRedraw("pointer"),scale:extendAndRedraw("scale")}}),createBinding({name:"kendoRadialGauge",defaultOption:VALUE,watch:{value:VALUE,gaugeArea:extendAndRedraw("gaugeArea"),pointer:extendAndRedraw("pointer"),scale:extendAndRedraw("scale")}})})(ko,jQuery)